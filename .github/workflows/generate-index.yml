name: ğŸ”„ Generate Index

on:
  push:
    paths:
      - '**/*.html'
      - '!index.html'
      - 'generate-index.js'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate-index:
    name: ğŸ“‹ Generate HTML Index
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: ğŸ” List HTML files
        run: |
          echo "ğŸ“š Fichiers HTML trouvÃ©s:"
          find . -name "*.html" -not -path "./.git/*" -not -name "index.html" | head -30
          echo ""
          echo "ğŸ“Š Total: $(find . -name "*.html" -not -path "./.git/*" -not -name "index.html" | wc -l) fichiers"
      
      - name: ğŸš€ Generate index.html
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ”„ GÃ©nÃ©ration de l'index C Concept&Dev"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          node generate-index.js
      
      - name: ğŸ“Š Verify generated index
        run: |
          if [ -f index.html ]; then
            echo "âœ… index.html gÃ©nÃ©rÃ© avec succÃ¨s"
            echo ""
            echo "ğŸ“¦ Taille du fichier:"
            ls -lh index.html
          else
            echo "âŒ Erreur: index.html non gÃ©nÃ©rÃ©"
            exit 1
          fi
      
      - name: ğŸ“¤ Commit and push index.html
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # VÃ©rifier s'il y a des changements
          if git diff --quiet index.html 2>/dev/null; then
            echo "â„¹ï¸ Pas de changements dÃ©tectÃ©s dans index.html"
          else
            git add index.html
            
            COMMIT_MSG="ğŸ”„ Auto-update index.html

ğŸ“‹ RÃ©gÃ©nÃ©ration automatique de l'index des pages
ğŸ“… $(date -u '+%Y-%m-%d %H:%M:%S UTC')

Triggered by: ${{ github.event_name }}
Commit: ${{ github.sha }}"
            
            git commit -m "$COMMIT_MSG"
            git push
            
            echo "âœ… index.html mis Ã  jour et poussÃ©"
          fi
      
      - name: ğŸ“‹ Summary
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… WORKFLOW TERMINÃ‰ AVEC SUCCÃˆS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "L'index.html est maintenant Ã  jour et accessible"
          echo "sur GitHub Pages."
          echo ""
