<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocal to Prompt Genius - G√©n√©rateur Universel</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Soft Jazz Palette */
            --jazz-deep: #1a1f2e;
            --jazz-mid: #2d3142;
            --jazz-accent: #4f5d75;
            --jazz-gold: #bfa181;
            --jazz-cream: #e8dcc4;
            --jazz-light: #f4f1ea;
            --jazz-highlight: #d4a574;
            --success: #7fa650;
            --warning: #d97830;
            --error: #c9434f;
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            
            /* Transitions */
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--jazz-deep) 0%, var(--jazz-mid) 100%);
            color: var(--jazz-cream);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-lg);
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: var(--space-xl);
            padding: var(--space-lg);
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-family: 'Libre Baskerville', serif;
            font-size: 2.5rem;
            color: var(--jazz-gold);
            margin-bottom: var(--space-sm);
            text-shadow: 0 2px 10px rgba(191, 161, 129, 0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            color: var(--jazz-cream);
            opacity: 0.8;
        }
        
        /* Mode Toggle */
        .mode-toggle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .mode-toggle {
            position: relative;
            display: flex;
            background: var(--jazz-accent);
            border-radius: 50px;
            padding: 6px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .mode-option {
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition-smooth);
            font-weight: 500;
            position: relative;
            z-index: 2;
            color: var(--jazz-cream);
        }
        
        .mode-option.active {
            color: var(--jazz-deep);
        }
        
        .mode-slider {
            position: absolute;
            top: 6px;
            left: 6px;
            width: calc(50% - 6px);
            height: calc(100% - 12px);
            background: linear-gradient(135deg, var(--jazz-gold), var(--jazz-highlight));
            border-radius: 50px;
            transition: var(--transition-smooth);
            box-shadow: 0 4px 15px rgba(191, 161, 129, 0.4);
        }
        
        .mode-slider.audio {
            transform: translateX(100%);
        }
        
        /* Content Areas */
        .content-area {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .content-area.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Written Mode */
        .written-mode {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: var(--space-lg);
            backdrop-filter: blur(10px);
        }
        
        .step {
            margin-bottom: var(--space-xl);
            padding: var(--space-lg);
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border-left: 4px solid var(--jazz-gold);
        }
        
        .step-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--jazz-gold), var(--jazz-highlight));
            color: var(--jazz-deep);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(191, 161, 129, 0.3);
        }
        
        .step-title {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.5rem;
            color: var(--jazz-gold);
        }
        
        .step-description {
            color: var(--jazz-cream);
            opacity: 0.8;
            margin-bottom: var(--space-md);
            font-size: 0.95rem;
        }
        
        .form-group {
            margin-bottom: var(--space-md);
        }
        
        label {
            display: block;
            margin-bottom: var(--space-xs);
            color: var(--jazz-gold);
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(191, 161, 129, 0.3);
            border-radius: 10px;
            color: var(--jazz-cream);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: var(--transition-smooth);
        }
        
        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--jazz-gold);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(191, 161, 129, 0.1);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* Audio Mode */
        .audio-mode {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: var(--space-xl);
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .audio-title {
            font-family: 'Libre Baskerville', serif;
            font-size: 2rem;
            color: var(--jazz-gold);
            margin-bottom: var(--space-md);
        }
        
        .audio-subtitle {
            color: var(--jazz-cream);
            opacity: 0.8;
            margin-bottom: var(--space-xl);
            font-size: 1.1rem;
        }
        
        .recorder-container {
            max-width: 700px;
            margin: 0 auto var(--space-xl);
        }
        
        .waveform {
            height: 120px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            margin-bottom: var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: var(--space-md);
            overflow: hidden;
        }
        
        .waveform-bar {
            width: 4px;
            height: 20px;
            background: var(--jazz-gold);
            border-radius: 2px;
            transition: height 0.1s ease;
        }
        
        .waveform.active .waveform-bar {
            animation: wave 0.8s ease-in-out infinite;
        }
        
        @keyframes wave {
            0%, 100% { height: 20px; }
            50% { height: 60px; }
        }
        
        .waveform-bar:nth-child(2n) { animation-delay: 0.1s; }
        .waveform-bar:nth-child(3n) { animation-delay: 0.2s; }
        .waveform-bar:nth-child(4n) { animation-delay: 0.3s; }
        
        .recorder-controls {
            display: flex;
            justify-content: center;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .record-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-smooth);
            position: relative;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .record-btn.start {
            background: linear-gradient(135deg, var(--jazz-gold), var(--jazz-highlight));
        }
        
        .record-btn.start:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(191, 161, 129, 0.5);
        }
        
        .record-btn.recording {
            background: var(--error);
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 8px 25px rgba(201, 67, 79, 0.3); }
            50% { box-shadow: 0 8px 40px rgba(201, 67, 79, 0.6); }
        }
        
        .record-btn .icon {
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
        }
        
        .record-btn.recording .icon {
            border-radius: 6px;
            width: 25px;
            height: 25px;
        }
        
        .control-btn {
            padding: 15px 30px;
            background: var(--jazz-accent);
            color: var(--jazz-cream);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition-smooth);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-btn:hover {
            background: var(--jazz-gold);
            color: var(--jazz-deep);
            transform: translateY(-2px);
        }
        
        .control-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
        
        .timer {
            font-size: 1.5rem;
            color: var(--jazz-gold);
            font-weight: 500;
            margin-bottom: var(--space-lg);
            font-variant-numeric: tabular-nums;
        }
        
        .transcription-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            min-height: 200px;
        }
        
        .transcription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }
        
        .transcription-title {
            color: var(--jazz-gold);
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .transcription-text {
            color: var(--jazz-cream);
            line-height: 1.8;
            white-space: pre-wrap;
            font-size: 1.05rem;
            padding: var(--space-md);
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            min-height: 150px;
            text-align: left;
        }
        
        .transcription-text[contenteditable="true"] {
            outline: none;
            border: 2px dashed rgba(191, 161, 129, 0.3);
        }
        
        .transcription-text[contenteditable="true"]:focus {
            border-color: var(--jazz-gold);
            background: rgba(0,0,0,0.3);
        }
        
        .transcription-text.empty {
            color: var(--jazz-accent);
            font-style: italic;
        }
        
        /* Buttons */
        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: var(--transition-smooth);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--jazz-gold), var(--jazz-highlight));
            color: var(--jazz-deep);
            box-shadow: 0 6px 20px rgba(191, 161, 129, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(191, 161, 129, 0.5);
        }
        
        .btn-secondary {
            background: var(--jazz-accent);
            color: var(--jazz-cream);
        }
        
        .btn-secondary:hover {
            background: var(--jazz-mid);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: var(--space-md);
            margin-top: var(--space-xl);
            flex-wrap: wrap;
        }
        
        /* Result Section */
        .result-section {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: var(--space-xl);
            margin-top: var(--space-xl);
            backdrop-filter: blur(10px);
        }
        
        .result-section.active {
            display: block;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }
        
        .result-title {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.8rem;
            color: var(--jazz-gold);
        }
        
        .prompt-output {
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(191, 161, 129, 0.2);
            border-radius: 15px;
            padding: var(--space-lg);
            color: var(--jazz-light);
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
            white-space: pre-wrap;
            max-height: 600px;
            overflow-y: auto;
            margin-bottom: var(--space-lg);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            padding: var(--space-md);
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--jazz-gold);
            display: block;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--jazz-cream);
            opacity: 0.7;
        }
        
        /* Library Section */
        .library-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: var(--space-xl);
            margin-top: var(--space-xl);
            backdrop-filter: blur(10px);
        }
        
        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            flex-wrap: wrap;
            gap: var(--space-md);
        }
        
        .library-title {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.8rem;
            color: var(--jazz-gold);
        }
        
        .search-bar {
            flex: 1;
            max-width: 400px;
        }
        
        .search-bar input {
            width: 100%;
            padding: 12px 20px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(191, 161, 129, 0.3);
            color: var(--jazz-cream);
        }
        
        .filter-tags {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            margin-bottom: var(--space-lg);
        }
        
        .tag {
            padding: 8px 16px;
            background: var(--jazz-accent);
            color: var(--jazz-cream);
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .tag:hover,
        .tag.active {
            background: var(--jazz-gold);
            color: var(--jazz-deep);
        }
        
        .prompts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-md);
        }
        
        .prompt-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: var(--space-md);
            cursor: pointer;
            transition: var(--transition-smooth);
            border: 2px solid transparent;
        }
        
        .prompt-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--jazz-gold);
            transform: translateY(-5px);
        }
        
        .prompt-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: var(--space-sm);
        }
        
        .prompt-card-title {
            font-weight: 600;
            color: var(--jazz-gold);
            font-size: 1.1rem;
        }
        
        .prompt-card-date {
            font-size: 0.85rem;
            color: var(--jazz-accent);
        }
        
        .prompt-card-project {
            color: var(--jazz-cream);
            font-size: 0.9rem;
            margin-bottom: var(--space-xs);
            opacity: 0.8;
        }
        
        .prompt-card-tags {
            display: flex;
            gap: var(--space-xs);
            flex-wrap: wrap;
            margin-bottom: var(--space-sm);
        }
        
        .prompt-card-tag {
            padding: 4px 10px;
            background: rgba(191, 161, 129, 0.2);
            color: var(--jazz-gold);
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        .prompt-card-preview {
            color: var(--jazz-cream);
            opacity: 0.6;
            font-size: 0.9rem;
            line-height: 1.5;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .prompt-card-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-sm);
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: var(--jazz-gold);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition-smooth);
        }
        
        .icon-btn:hover {
            background: rgba(191, 161, 129, 0.2);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: var(--space-lg);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--jazz-mid);
            border-radius: 20px;
            padding: var(--space-xl);
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }
        
        .modal-title {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.8rem;
            color: var(--jazz-gold);
        }
        
        .close-modal {
            background: none;
            border: none;
            color: var(--jazz-cream);
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition-smooth);
        }
        
        .close-modal:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--jazz-gold);
            color: var(--jazz-deep);
            padding: var(--space-md) var(--space-lg);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 500;
            animation: slideInRight 0.3s ease;
        }
        
        .toast.active {
            display: flex;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast.success { background: var(--success); color: white; }
        .toast.error { background: var(--error); color: white; }
        
        /* Analysis Section */
        .analysis-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
        }
        
        .analysis-title {
            color: var(--jazz-gold);
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: var(--space-md);
        }
        
        .analysis-item {
            margin-bottom: var(--space-md);
            padding: var(--space-md);
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            border-left: 3px solid var(--jazz-gold);
        }
        
        .analysis-item-label {
            color: var(--jazz-gold);
            font-weight: 600;
            margin-bottom: var(--space-xs);
            font-size: 0.9rem;
        }
        
        .analysis-item-content {
            color: var(--jazz-cream);
            line-height: 1.6;
        }
        
        .analysis-item-content ul {
            margin-left: var(--space-md);
            margin-top: var(--space-xs);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-xl);
            color: var(--jazz-accent);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--space-md);
            opacity: 0.3;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .mode-option {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .container {
                padding: var(--space-md);
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .prompts-grid {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--jazz-gold);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--jazz-highlight);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üé∑ Vocal to Prompt Genius</h1>
            <p>Transforme tes id√©es d√©cousues en prompts structur√©s de haut niveau</p>
        </div>
        
        <!-- Mode Toggle -->
        <div class="mode-toggle-container">
            <div class="mode-toggle">
                <div class="mode-slider" id="modeSlider"></div>
                <div class="mode-option active" data-mode="written">‚úçÔ∏è Mode √âcrit</div>
                <div class="mode-option" data-mode="audio">üé§ Mode Audio</div>
            </div>
        </div>
        
        <!-- Written Mode -->
        <div class="content-area active" id="writtenMode">
            <div class="written-mode">
                <!-- Step 1: Objectif -->
                <div class="step">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <h2 class="step-title">OBJECTIF</h2>
                    </div>
                    <p class="step-description">Que veux-tu cr√©er ou obtenir pr√©cis√©ment ? Quel r√©sultat final attends-tu ?</p>
                    <div class="form-group">
                        <label for="objective">D√©cris ton objectif *</label>
                        <textarea id="objective" placeholder="Exemple : Je veux cr√©er un cours de basse pour d√©butants sur le funk, avec des exercices progressifs bas√©s sur les lignes de James Jamerson..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="expectedResult">R√©sultat attendu *</label>
                        <input type="text" id="expectedResult" placeholder="Ex: Un plan de cours structur√© sur 12 semaines avec exercices et playbacks">
                    </div>
                </div>
                
                <!-- Step 2: Contexte -->
                <div class="step">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <h2 class="step-title">CONTEXTE</h2>
                    </div>
                    <p class="step-description">Donne-moi le contexte complet : domaine, audience, usage, background...</p>
                    <div class="form-group">
                        <label for="domain">Domaine / Sp√©cialit√© *</label>
                        <input type="text" id="domain" placeholder="Ex: P√©dagogie musicale, Marketing digital, D√©veloppement web...">
                    </div>
                    <div class="form-group">
                        <label for="audience">Public cible *</label>
                        <input type="text" id="audience" placeholder="Ex: Bassistes d√©butants 16-30 ans, Professionnels du secteur...">
                    </div>
                    <div class="form-group">
                        <label for="usage">Usage / Application</label>
                        <textarea id="usage" placeholder="Comment et o√π ce contenu sera utilis√© ?"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="background">Background / Contexte additionnel</label>
                        <textarea id="background" placeholder="Toute information pertinente pour comprendre le contexte..."></textarea>
                    </div>
                </div>
                
                <!-- Step 3: Contraintes -->
                <div class="step">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <h2 class="step-title">CONTRAINTES</h2>
                    </div>
                    <p class="step-description">Pr√©cise les limites et exigences : format, longueur, d√©lais, niveau...</p>
                    <div class="form-group">
                        <label for="format">Format souhait√© *</label>
                        <select id="format">
                            <option value="">-- Choisir un format --</option>
                            <option value="markdown">Markdown</option>
                            <option value="html">HTML</option>
                            <option value="pdf">PDF</option>
                            <option value="document">Document texte</option>
                            <option value="presentation">Pr√©sentation</option>
                            <option value="script">Script / Code</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="length">Longueur / Dur√©e *</label>
                        <input type="text" id="length" placeholder="Ex: 3000 mots, 12 pages, 2 heures de formation...">
                    </div>
                    <div class="form-group">
                        <label for="level">Niveau de complexit√© *</label>
                        <select id="level">
                            <option value="">-- Choisir un niveau --</option>
                            <option value="d√©butant">D√©butant</option>
                            <option value="interm√©diaire">Interm√©diaire</option>
                            <option value="avanc√©">Avanc√©</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="deadline">D√©lai / √âch√©ance</label>
                        <input type="text" id="deadline" placeholder="Ex: Urgent, 1 semaine, projet √† long terme...">
                    </div>
                </div>
                
                <!-- Step 4: Sp√©cifications -->
                <div class="step">
                    <div class="step-header">
                        <div class="step-number">4</div>
                        <h2 class="step-title">SP√âCIFICATIONS</h2>
                    </div>
                    <p class="step-description">D√©taille les √©l√©ments obligatoires, le style, le ton, les exemples √† inclure...</p>
                    <div class="form-group">
                        <label for="mustInclude">√âl√©ments √† INCLURE obligatoirement *</label>
                        <textarea id="mustInclude" placeholder="Liste les √©l√©ments essentiels que le contenu DOIT contenir..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="mustExclude">√âl√©ments √† EXCLURE absolument</label>
                        <textarea id="mustExclude" placeholder="Ce qui ne doit PAS appara√Ætre dans le contenu..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="tone">Ton / Style *</label>
                        <input type="text" id="tone" placeholder="Ex: Bienveillant, professionnel, d√©contract√©, acad√©mique...">
                    </div>
                    <div class="form-group">
                        <label for="examples">Exemples / R√©f√©rences</label>
                        <textarea id="examples" placeholder="Donne des exemples concrets ou r√©f√©rences √† suivre..."></textarea>
                    </div>
                </div>
                
                <!-- Step 5: Crit√®res Qualit√© + Option Audio -->
                <div class="step">
                    <div class="step-header">
                        <div class="step-number">5</div>
                        <h2 class="step-title">CRIT√àRES QUALIT√â</h2>
                    </div>
                    <p class="step-description">Qu'est-ce qui d√©finit que le r√©sultat sera "parfait" pour toi ?</p>
                    <div class="form-group">
                        <label for="successCriteria">Crit√®res de succ√®s *</label>
                        <textarea id="successCriteria" placeholder="Le contenu sera parfait si... (d√©cris les crit√®res mesurables)"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="priorities">Priorit√©s (1 = le plus important)</label>
                        <textarea id="priorities" placeholder="Classe tes priorit√©s : 1. Clart√© p√©dagogique, 2. Exemples concrets, 3. ..."></textarea>
                    </div>
                    
                    <hr style="margin: var(--space-lg) 0; border: none; border-top: 1px solid rgba(191,161,129,0.2);">
                    
                    <div style="text-align: center; margin-top: var(--space-lg);">
                        <p style="color: var(--jazz-gold); font-weight: 600; margin-bottom: var(--space-md);">
                            üí° Ajouter des pr√©cisions vocales compl√©mentaires ?
                        </p>
                        <button class="btn btn-secondary" id="addAudioBtn">
                            üé§ Enregistrer pr√©cisions audio
                        </button>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-primary" id="generateWrittenPrompt">
                        ‚ú® G√©n√©rer le Prompt Optimal
                    </button>
                    <button class="btn btn-secondary" id="resetWrittenForm">
                        üîÑ R√©initialiser
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Audio Mode -->
        <div class="content-area" id="audioMode">
            <div class="audio-mode">
                <h2 class="audio-title">üéôÔ∏è Parle librement de ton projet</h2>
                <p class="audio-subtitle">D√©cris ce qui te passe par la t√™te, m√™me si c'est d√©cousu. Je vais structurer tout √ßa.</p>
                
                <div class="recorder-container">
                    <!-- Timer -->
                    <div class="timer" id="timer">00:00</div>
                    
                    <!-- Waveform -->
                    <div class="waveform" id="waveform">
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                    </div>
                    
                    <!-- Controls -->
                    <div class="recorder-controls">
                        <button class="record-btn start" id="recordBtn" title="Commencer l'enregistrement">
                            <div class="icon"></div>
                        </button>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem;">
                        <button class="control-btn" id="pauseBtn" disabled>
                            ‚è∏Ô∏è Pause
                        </button>
                        <button class="control-btn" id="stopBtn" disabled>
                            ‚èπÔ∏è Arr√™ter
                        </button>
                    </div>
                    
                    <!-- Transcription -->
                    <div class="transcription-container">
                        <div class="transcription-header">
                            <div class="transcription-title">üìù Transcription en direct</div>
                            <button class="control-btn" id="editTranscriptionBtn" disabled>
                                ‚úèÔ∏è Modifier
                            </button>
                        </div>
                        <div class="transcription-text empty" id="transcriptionText" contenteditable="false">
                            La transcription appara√Ætra ici en temps r√©el...
                        </div>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-primary" id="analyzeAudioBtn" disabled>
                        üß† Analyser & G√©n√©rer le Prompt
                    </button>
                    <button class="btn btn-secondary" id="resetAudioBtn">
                        üîÑ Nouvelle Session
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Result Section -->
        <div class="result-section" id="resultSection">
            <div class="result-header">
                <h2 class="result-title">‚ú® Prompt G√©n√©r√©</h2>
                <button class="btn btn-primary" id="copyPromptBtn">
                    üìã Copier le Prompt
                </button>
            </div>
            
            <!-- Analysis (for audio mode) -->
            <div class="analysis-section" id="analysisSection" style="display: none;">
                <h3 class="analysis-title">üß† Analyse de ta description</h3>
                <div id="analysisContent"></div>
            </div>
            
            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <span class="stat-value" id="statWords">0</span>
                    <span class="stat-label">Mots</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="statSections">0</span>
                    <span class="stat-label">Sections</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="statScore">0%</span>
                    <span class="stat-label">Score Qualit√©</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="statChars">0</span>
                    <span class="stat-label">Caract√®res</span>
                </div>
            </div>
            
            <!-- Prompt Output -->
            <div class="prompt-output" id="promptOutput"></div>
            
            <!-- Save Section -->
            <div class="form-group">
                <label for="promptProject">üè∑Ô∏è Nom du projet / Tag</label>
                <input type="text" id="promptProject" placeholder="Ex: Prof de Basse, Formation Marketing, Site Web Client...">
            </div>
            
            <div class="form-group">
                <label for="promptTags">üîñ Tags (s√©par√©s par des virgules)</label>
                <input type="text" id="promptTags" placeholder="Ex: p√©dagogie, musique, bass, d√©butant">
            </div>
            
            <div class="actions">
                <button class="btn btn-primary" id="savePromptBtn">
                    üíæ Sauvegarder dans la Biblioth√®que
                </button>
                <button class="btn btn-secondary" id="newPromptBtn">
                    ‚ûï Cr√©er un Nouveau Prompt
                </button>
            </div>
        </div>
        
        <!-- Library Section -->
        <div class="library-section">
            <div class="library-header">
                <h2 class="library-title">üìö Biblioth√®que de Prompts</h2>
                <div class="search-bar">
                    <input type="text" id="searchLibrary" placeholder="üîç Rechercher dans la biblioth√®que...">
                </div>
            </div>
            
            <div class="filter-tags" id="filterTags">
                <div class="tag active" data-filter="all">Tous</div>
            </div>
            
            <div class="prompts-grid" id="promptsGrid">
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <p>Aucun prompt sauvegard√© pour le moment.</p>
                    <p>Cr√©e ton premier prompt ci-dessus !</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal -->
    <div class="modal" id="promptModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">D√©tails du Prompt</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div id="modalBody"></div>
            <div class="actions">
                <button class="btn btn-primary" id="copyModalPrompt">
                    üìã Copier
                </button>
                <button class="btn btn-secondary" id="deleteModalPrompt">
                    üóëÔ∏è Supprimer
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toastMessage"></span>
    </div>
    
    <script>
        // ==========================================
        // STATE MANAGEMENT
        // ==========================================
        let currentMode = 'written';
        let isRecording = false;
        let isPaused = false;
        let recognition = null;
        let transcription = '';
        let startTime = null;
        let timerInterval = null;
        let currentPromptData = null;
        let audioComplementMode = false;
        
        // ==========================================
        // MODE TOGGLE
        // ==========================================
        const modeOptions = document.querySelectorAll('.mode-option');
        const modeSlider = document.getElementById('modeSlider');
        const writtenMode = document.getElementById('writtenMode');
        const audioMode = document.getElementById('audioMode');
        
        modeOptions.forEach(option => {
            option.addEventListener('click', () => {
                const mode = option.dataset.mode;
                switchMode(mode);
            });
        });
        
        function switchMode(mode) {
            currentMode = mode;
            
            modeOptions.forEach(opt => {
                opt.classList.toggle('active', opt.dataset.mode === mode);
            });
            
            if (mode === 'audio') {
                modeSlider.classList.add('audio');
                writtenMode.classList.remove('active');
                audioMode.classList.add('active');
            } else {
                modeSlider.classList.remove('audio');
                audioMode.classList.remove('active');
                writtenMode.classList.add('active');
            }
        }
        
        // ==========================================
        // SPEECH RECOGNITION SETUP
        // ==========================================
        function initSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showToast('La reconnaissance vocale n\'est pas support√©e par ton navigateur', 'error');
                return false;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR';
            recognition.continuous = true;
            recognition.interimResults = true;
            
            recognition.onstart = () => {
                isRecording = true;
                isPaused = false;
                updateRecordingUI();
            };
            
            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                transcription += finalTranscript;
                updateTranscriptionDisplay(transcription + interimTranscript);
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                if (event.error !== 'no-speech') {
                    showToast('Erreur de reconnaissance vocale: ' + event.error, 'error');
                }
            };
            
            recognition.onend = () => {
                if (isRecording && !isPaused) {
                    recognition.start();
                }
            };
            
            return true;
        }
        
        // ==========================================
        // AUDIO RECORDING CONTROLS
        // ==========================================
        const recordBtn = document.getElementById('recordBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const waveform = document.getElementById('waveform');
        const timerDisplay = document.getElementById('timer');
        const transcriptionText = document.getElementById('transcriptionText');
        const editTranscriptionBtn = document.getElementById('editTranscriptionBtn');
        const analyzeAudioBtn = document.getElementById('analyzeAudioBtn');
        const resetAudioBtn = document.getElementById('resetAudioBtn');
        
        recordBtn.addEventListener('click', () => {
            if (!isRecording) {
                startRecording();
            }
        });
        
        pauseBtn.addEventListener('click', () => {
            if (isRecording && !isPaused) {
                pauseRecording();
            } else if (isPaused) {
                resumeRecording();
            }
        });
        
        stopBtn.addEventListener('click', () => {
            stopRecording();
        });
        
        editTranscriptionBtn.addEventListener('click', () => {
            const isEditable = transcriptionText.getAttribute('contenteditable') === 'true';
            transcriptionText.setAttribute('contenteditable', !isEditable);
            editTranscriptionBtn.textContent = isEditable ? '‚úèÔ∏è Modifier' : '‚úÖ Valider';
            if (!isEditable) {
                transcriptionText.focus();
            } else {
                transcription = transcriptionText.textContent;
            }
        });
        
        function startRecording() {
            if (!initSpeechRecognition()) return;
            
            transcription = '';
            startTime = Date.now();
            recognition.start();
            
            timerInterval = setInterval(updateTimer, 1000);
            
            updateRecordingUI();
            showToast('Enregistrement d√©marr√© üé§', 'success');
        }
        
        function pauseRecording() {
            isPaused = true;
            recognition.stop();
            pauseBtn.textContent = '‚ñ∂Ô∏è Reprendre';
            waveform.classList.remove('active');
            showToast('Enregistrement en pause', 'warning');
        }
        
        function resumeRecording() {
            isPaused = false;
            recognition.start();
            pauseBtn.textContent = '‚è∏Ô∏è Pause';
            waveform.classList.add('active');
            showToast('Enregistrement repris', 'success');
        }
        
        function stopRecording() {
            isRecording = false;
            isPaused = false;
            
            if (recognition) {
                recognition.stop();
            }
            
            clearInterval(timerInterval);
            
            updateRecordingUI();
            
            if (transcription.trim()) {
                showToast('Enregistrement termin√© ‚úÖ', 'success');
                analyzeAudioBtn.disabled = false;
                editTranscriptionBtn.disabled = false;
            } else {
                showToast('Aucune transcription d√©tect√©e', 'error');
            }
        }
        
        function updateRecordingUI() {
            if (isRecording) {
                recordBtn.classList.add('recording');
                recordBtn.classList.remove('start');
                recordBtn.title = 'Enregistrement en cours...';
                waveform.classList.add('active');
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
            } else {
                recordBtn.classList.remove('recording');
                recordBtn.classList.add('start');
                recordBtn.title = 'Commencer l\'enregistrement';
                waveform.classList.remove('active');
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                pauseBtn.textContent = '‚è∏Ô∏è Pause';
            }
        }
        
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${minutes}:${seconds}`;
        }
        
        function updateTranscriptionDisplay(text) {
            transcriptionText.classList.remove('empty');
            transcriptionText.textContent = text;
        }
        
        resetAudioBtn.addEventListener('click', () => {
            if (isRecording) {
                stopRecording();
            }
            
            transcription = '';
            transcriptionText.textContent = 'La transcription appara√Ætra ici en temps r√©el...';
            transcriptionText.classList.add('empty');
            transcriptionText.setAttribute('contenteditable', 'false');
            timerDisplay.textContent = '00:00';
            editTranscriptionBtn.textContent = '‚úèÔ∏è Modifier';
            editTranscriptionBtn.disabled = true;
            analyzeAudioBtn.disabled = true;
            
            document.getElementById('resultSection').classList.remove('active');
        });
        
        // ==========================================
        // AUDIO MODE - ANALYZE & GENERATE
        // ==========================================
        analyzeAudioBtn.addEventListener('click', () => {
            const text = transcriptionText.textContent.trim();
            if (!text || text === 'La transcription appara√Ætra ici en temps r√©el...') {
                showToast('Aucune transcription √† analyser', 'error');
                return;
            }
            
            const analysis = analyzeTranscription(text);
            const prompt = generatePromptFromAnalysis(analysis, text);
            
            displayResult(prompt, analysis);
            showToast('Prompt g√©n√©r√© avec succ√®s ! üéâ', 'success');
        });
        
        function analyzeTranscription(text) {
            // Analyse s√©mantique pour remplir les 5 sections identiques au mode √©crit
            const analysis = {
                // Section 1: OBJECTIF
                objective: extractObjective(text),
                expectedResult: extractExpectedResult(text),
                
                // Section 2: CONTEXTE
                domain: extractDomain(text),
                audience: extractAudience(text),
                usage: extractUsage(text),
                background: extractBackground(text),
                
                // Section 3: CONTRAINTES
                format: extractFormat(text),
                length: extractLength(text),
                level: extractLevel(text),
                deadline: extractDeadline(text),
                
                // Section 4: SP√âCIFICATIONS
                mustInclude: extractMustInclude(text),
                mustExclude: extractMustExclude(text),
                tone: extractTone(text),
                examples: extractExamples(text),
                
                // Section 5: CRIT√àRES QUALIT√â
                successCriteria: extractSuccessCriteria(text),
                priorities: extractPriorities(text)
            };
            
            return analysis;
        }
        
        // ===== SECTION 1: OBJECTIF =====
        function extractObjective(text) {
            const patterns = [
                /je (?:veux|voudrais|souhaite|aimerais|cherche √†) (?:cr√©er|faire|d√©velopper|construire|g√©n√©rer|produire|avoir|obtenir) (.+?)(?:[,\.]|$)/gi,
                /l['\']objectif (?:est|serait|c'est) (?:de )?(.+?)(?:[,\.]|$)/gi,
                /(?:il faut|faudrait|besoin de) (.+?)(?:[,\.]|$)/gi,
                /(?:cr√©er|faire|d√©velopper) (.+?) (?:pour|qui|avec)/gi
            ];
            
            let objectives = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => {
                    const obj = match[1].trim();
                    if (obj.length > 10 && obj.length < 200) {
                        objectives.push(obj);
                    }
                });
            });
            
            return objectives.length > 0 ? objectives.slice(0, 3).join('. ') : text.split(/[\.!?]/)[0] || '√Ä d√©finir selon la description';
        }
        
        function extractExpectedResult(text) {
            const patterns = [
                /(?:r√©sultat|sortie|output|livrable) (?:attendu|souhait√©|final|serait) (.+?)(?:[,\.]|$)/gi,
                /√† la (?:fin|finale) (.+?)(?:[,\.]|$)/gi,
                /(?:√ßa devrait|devrait donner|obtenir) (.+?)(?:[,\.]|$)/gi
            ];
            
            let results = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => results.push(match[1].trim()));
            });
            
            return results.length > 0 ? results.join('. ') : 'Contenu de qualit√© r√©pondant √† l\'objectif d√©fini';
        }
        
        // ===== SECTION 2: CONTEXTE =====
        function extractDomain(text) {
            const patterns = [
                /(?:dans le (?:domaine|secteur|contexte|cadre) (?:de |d['']|du )?|c['']est (?:du |de la )?|pour le (?:domaine|secteur) (?:de |d[''])?|en (?:terme de |mati√®re de ))(.+?)(?:[,\.]|$)/gi,
                /(?:sp√©cialit√©|th√©matique|sujet) (?:c['']est |est )?(.+?)(?:[,\.]|$)/gi
            ];
            
            let domains = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => domains.push(match[1].trim()));
            });
            
            // D√©tection de mots-cl√©s domaine
            const domainKeywords = [
                'musique', 'basse', 'p√©dagogie', 'formation', 'cours',
                'marketing', 'web', 'd√©veloppement', 'code', 'programmation',
                'th√©rapie', 'psychologie', 'couple', 'sant√©',
                'business', 'entreprise', 'startup', 'projet'
            ];
            
            const textLower = text.toLowerCase();
            domainKeywords.forEach(keyword => {
                if (textLower.includes(keyword) && domains.length === 0) {
                    domains.push(keyword);
                }
            });
            
            return domains.length > 0 ? domains.slice(0, 2).join(' / ') : '√Ä pr√©ciser';
        }
        
        function extractAudience(text) {
            const patterns = [
                /(?:pour (?:des |les |le )?|destin√© √† |√† destination de |public (?:cible |est )?|audience )(.+?)(?:[,\.]|$)/gi,
                /(d√©butants?|interm√©diaires?|avanc√©s?|experts?|professionnels?|√©tudiants?|√©l√®ves?)/gi,
                /(?:√¢g√©s? de |entre) (\d+).+?(?:ans|ann√©es)/gi
            ];
            
            let audiences = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => audiences.push(match[1].trim()));
            });
            
            return audiences.length > 0 ? audiences.join(', ') : 'Tout public';
        }
        
        function extractUsage(text) {
            const patterns = [
                /(?:utiliser|servir|employer|√™tre utilis√©) (?:pour |√† |dans )(.+?)(?:[,\.]|$)/gi,
                /(?:va √™tre|sera) (?:utilis√©|diffus√©|partag√©|publi√©) (.+?)(?:[,\.]|$)/gi,
                /(?:sur|via|√† travers) (.+?)(?:[,\.]|$)/gi
            ];
            
            let usages = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => usages.push(match[1].trim()));
            });
            
            return usages.length > 0 ? usages.join('. ') : '';
        }
        
        function extractBackground(text) {
            // R√©cup√®re des phrases contextuelles g√©n√©rales
            const sentences = text.split(/[\.!?]+/).filter(s => s.trim().length > 20);
            const backgroundSentences = sentences.filter(s => {
                const lower = s.toLowerCase();
                return lower.includes('contexte') || 
                       lower.includes('actuellement') || 
                       lower.includes('d√©j√†') ||
                       lower.includes('important') ||
                       lower.includes('savoir');
            });
            
            return backgroundSentences.slice(0, 2).join('. ') || '';
        }
        
        // ===== SECTION 3: CONTRAINTES =====
        function extractFormat(text) {
            const formats = {
                'markdown': /markdown|\.md/gi,
                'html': /html|page web|site/gi,
                'pdf': /pdf/gi,
                'document': /document|doc|texte|word/gi,
                'presentation': /pr√©sentation|pptx|slides|powerpoint/gi,
                'script': /script|code|programme/gi,
                'video': /vid√©o|film/gi,
                'audio': /audio|podcast|mp3/gi
            };
            
            for (let format in formats) {
                if (formats[format].test(text)) {
                    return format;
                }
            }
            
            return 'markdown';
        }
        
        function extractLength(text) {
            const lengthPatterns = [
                /(\d+)\s*(pages?|mots?|minutes?|heures?|s√©ances?|chapitres?|sections?)/gi,
                /(?:environ|autour de|√† peu pr√®s) (\d+)/gi,
                /(?:court|long|moyen|petit|grand)/gi
            ];
            
            let lengths = [];
            lengthPatterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => lengths.push(match[0].trim()));
            });
            
            return lengths.length > 0 ? lengths[0] : 'Selon besoin';
        }
        
        function extractLevel(text) {
            const levels = {
                'd√©butant': /d√©butant|novice|initial|basique|base/gi,
                'interm√©diaire': /interm√©diaire|moyen|standard/gi,
                'avanc√©': /avanc√©|confirm√©|approfondi/gi,
                'expert': /expert|professionnel|ma√Ætre|master/gi
            };
            
            for (let level in levels) {
                if (levels[level].test(text)) {
                    return level;
                }
            }
            
            return 'interm√©diaire';
        }
        
        function extractDeadline(text) {
            const patterns = [
                /(?:dans|d['']ici|d√©lai de) (\d+) (jours?|semaines?|mois)/gi,
                /(?:urgent|rapidement|vite|asap)/gi,
                /(?:pas press√©|long terme|quand tu veux)/gi
            ];
            
            let deadlines = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => deadlines.push(match[0].trim()));
            });
            
            return deadlines.length > 0 ? deadlines[0] : '';
        }
        
        // ===== SECTION 4: SP√âCIFICATIONS =====
        function extractMustInclude(text) {
            const patterns = [
                /(?:inclure|ajouter|mettre|int√©grer|avec|comporte) (.+?)(?:[,\.]|et|$)/gi,
                /(?:il faut|doit y? ?avoir|obligatoire|essentiel|important) (.+?)(?:[,\.]|et|$)/gi,
                /(?:n√©cessaire de|besoin de) (.+?)(?:[,\.]|et|$)/gi
            ];
            
            let includes = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => {
                    const item = match[1].trim();
                    if (item.length > 5 && item.length < 150) {
                        includes.push(item);
                    }
                });
            });
            
            return includes.length > 0 ? includes.join('\n- ') : '√âl√©ments selon objectif';
        }
        
        function extractMustExclude(text) {
            const patterns = [
                /(?:sans|pas de|√©viter|exclure|ne pas) (.+?)(?:[,\.]|$)/gi,
                /(?:surtout pas|jamais) (.+?)(?:[,\.]|$)/gi
            ];
            
            let excludes = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => {
                    const item = match[1].trim();
                    if (item.length > 5 && item.length < 100) {
                        excludes.push(item);
                    }
                });
            });
            
            return excludes.length > 0 ? excludes.join('\n- ') : '';
        }
        
        function extractTone(text) {
            const tones = {
                'bienveillant, chaleureux': /(?:bienveillant|doux|empathique|chaleureux|humain)/gi,
                'professionnel, formel': /(?:professionnel|formel|s√©rieux|corporate|business)/gi,
                'd√©contract√©, cool': /(?:d√©contract√©|cool|relax|informel|casual|sympa)/gi,
                'p√©dagogique, clair': /(?:p√©dagogique|didactique|√©ducatif|explicatif|clair|simple)/gi,
                'technique, pr√©cis': /(?:technique|pr√©cis|d√©taill√©|expert|pointu)/gi,
                'cr√©atif, original': /(?:cr√©atif|original|innovant|unique)/gi
            };
            
            for (let tone in tones) {
                if (tones[tone].test(text)) {
                    return tone;
                }
            }
            
            return 'professionnel et clair';
        }
        
        function extractExamples(text) {
            const patterns = [
                /(?:exemple|par exemple|comme|tel que) (.+?)(?:[,\.]|$)/gi,
                /(?:r√©f√©rence|inspiration|style) (.+?)(?:[,\.]|$)/gi
            ];
            
            let examples = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => examples.push(match[1].trim()));
            });
            
            return examples.length > 0 ? examples.join('. ') : '';
        }
        
        // ===== SECTION 5: CRIT√àRES QUALIT√â =====
        function extractSuccessCriteria(text) {
            const patterns = [
                /(?:ce sera parfait si|r√©ussi si|bon si|qualit√© si) (.+?)(?:[,\.]|$)/gi,
                /(?:crit√®re|mesure) (?:de succ√®s |est |c['']est )(.+?)(?:[,\.]|$)/gi,
                /(?:important que|essentiel que|crucial que) (.+?)(?:[,\.]|$)/gi
            ];
            
            let criteria = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => criteria.push(match[1].trim()));
            });
            
            return criteria.length > 0 ? criteria.join('\n- ') : 'Le contenu r√©pond pr√©cis√©ment √† l\'objectif d√©fini avec qualit√© et professionnalisme';
        }
        
        function extractPriorities(text) {
            const patterns = [
                /(?:priorit√©|d['']abord|avant tout|surtout|le plus important) (.+?)(?:[,\.]|$)/gi,
                /(?:en premier|premi√®rement|prioritaire) (.+?)(?:[,\.]|$)/gi
            ];
            
            let priorities = [];
            patterns.forEach(pattern => {
                const matches = [...text.matchAll(pattern)];
                matches.forEach(match => priorities.push(match[1].trim()));
            });
            
            if (priorities.length > 0) {
                return priorities.map((p, i) => `${i + 1}. ${p}`).join('\n');
            }
            
            return '';
        }
        
        function generatePromptFromAnalysis(analysis, originalText) {
            // G√âN√àRE LE M√äME FORMAT QUE LE MODE √âCRIT
            let prompt = `# BRIEF DE G√âN√âRATION - PROMPT STRUCTUR√â
(G√©n√©r√© automatiquement depuis description vocale)

## üéØ OBJECTIF

**Ce que je veux cr√©er:**
${analysis.objective}

**R√©sultat attendu:**
${analysis.expectedResult}

---

## üìã CONTEXTE

**Domaine / Sp√©cialit√©:**
${analysis.domain}

**Public cible:**
${analysis.audience}`;

            if (analysis.usage) {
                prompt += `\n\n**Usage / Application:**\n${analysis.usage}`;
            }
            
            if (analysis.background) {
                prompt += `\n\n**Contexte additionnel:**\n${analysis.background}`;
            }
            
            prompt += `\n\n---

## ‚öôÔ∏è CONTRAINTES

**Format:** ${analysis.format}
**Longueur / Dur√©e:** ${analysis.length}
**Niveau de complexit√©:** ${analysis.level}`;
            
            if (analysis.deadline) {
                prompt += `\n**D√©lai:** ${analysis.deadline}`;
            }
            
            prompt += `\n\n---

## üìù SP√âCIFICATIONS

**√âl√©ments √† INCLURE obligatoirement:**
- ${analysis.mustInclude}`;
            
            if (analysis.mustExclude) {
                prompt += `\n\n**√âl√©ments √† EXCLURE absolument:**\n- ${analysis.mustExclude}`;
            }
            
            prompt += `\n\n**Ton / Style:** ${analysis.tone}`;
            
            if (analysis.examples) {
                prompt += `\n\n**Exemples / R√©f√©rences:**\n${analysis.examples}`;
            }
            
            prompt += `\n\n---

## ‚úÖ CRIT√àRES QUALIT√â

**Crit√®res de succ√®s:**
- ${analysis.successCriteria}`;
            
            if (analysis.priorities) {
                prompt += `\n\n**Priorit√©s:**\n${analysis.priorities}`;
            }
            
            prompt += `\n\n---

## üöÄ INSTRUCTIONS DE PRODUCTION

En te basant sur ce brief complet:

1. **Analyse**: Assure-toi de bien comprendre tous les √©l√©ments du contexte
2. **Planification**: Structure ton approche pour couvrir tous les points
3. **Ex√©cution**: Produis un contenu de niveau expert
4. **Validation**: V√©rifie que tous les crit√®res de succ√®s sont atteints
5. **Optimisation**: Peaufine pour maximiser la qualit√©

**IMPORTANT**: Ce contenu doit √™tre imm√©diatement utilisable et d√©passer les attentes en termes de qualit√©, profondeur et pertinence.

---

üìù **DESCRIPTION ORIGINALE (pour r√©f√©rence):**
"${originalText.substring(0, 500)}${originalText.length > 500 ? '...' : ''}"`;
            
            return prompt;
        }
        
        // ==========================================
        // WRITTEN MODE - GENERATE PROMPT
        // ==========================================
        const generateWrittenPromptBtn = document.getElementById('generateWrittenPrompt');
        const resetWrittenFormBtn = document.getElementById('resetWrittenForm');
        const addAudioBtn = document.getElementById('addAudioBtn');
        
        generateWrittenPromptBtn.addEventListener('click', () => {
            const data = collectWrittenFormData();
            
            if (!validateWrittenForm(data)) {
                showToast('Merci de remplir tous les champs obligatoires (*)', 'error');
                return;
            }
            
            const prompt = generateWrittenPrompt(data);
            displayResult(prompt);
            showToast('Prompt g√©n√©r√© avec succ√®s ! üéâ', 'success');
        });
        
        resetWrittenFormBtn.addEventListener('click', () => {
            if (confirm('R√©initialiser le formulaire ? Toutes les donn√©es seront perdues.')) {
                document.querySelectorAll('#writtenMode input, #writtenMode textarea, #writtenMode select').forEach(field => {
                    field.value = '';
                });
                document.getElementById('resultSection').classList.remove('active');
                showToast('Formulaire r√©initialis√©', 'success');
            }
        });
        
        addAudioBtn.addEventListener('click', () => {
            audioComplementMode = true;
            switchMode('audio');
            showToast('Mode audio compl√©mentaire activ√© üé§', 'success');
        });
        
        function collectWrittenFormData() {
            return {
                objective: document.getElementById('objective').value.trim(),
                expectedResult: document.getElementById('expectedResult').value.trim(),
                domain: document.getElementById('domain').value.trim(),
                audience: document.getElementById('audience').value.trim(),
                usage: document.getElementById('usage').value.trim(),
                background: document.getElementById('background').value.trim(),
                format: document.getElementById('format').value,
                length: document.getElementById('length').value.trim(),
                level: document.getElementById('level').value,
                deadline: document.getElementById('deadline').value.trim(),
                mustInclude: document.getElementById('mustInclude').value.trim(),
                mustExclude: document.getElementById('mustExclude').value.trim(),
                tone: document.getElementById('tone').value.trim(),
                examples: document.getElementById('examples').value.trim(),
                successCriteria: document.getElementById('successCriteria').value.trim(),
                priorities: document.getElementById('priorities').value.trim()
            };
        }
        
        function validateWrittenForm(data) {
            const requiredFields = [
                'objective', 'expectedResult', 'domain', 'audience',
                'format', 'length', 'level', 'mustInclude', 'tone', 'successCriteria'
            ];
            
            return requiredFields.every(field => data[field] && data[field].length > 0);
        }
        
        function generateWrittenPrompt(data) {
            let prompt = `# BRIEF DE G√âN√âRATION - PROMPT STRUCTUR√â

## üéØ OBJECTIF

**Ce que je veux cr√©er:**
${data.objective}

**R√©sultat attendu:**
${data.expectedResult}

---

## üìã CONTEXTE

**Domaine / Sp√©cialit√©:**
${data.domain}

**Public cible:**
${data.audience}`;

            if (data.usage) {
                prompt += `\n\n**Usage / Application:**\n${data.usage}`;
            }
            
            if (data.background) {
                prompt += `\n\n**Contexte additionnel:**\n${data.background}`;
            }
            
            prompt += `\n\n---

## ‚öôÔ∏è CONTRAINTES

**Format:** ${data.format}
**Longueur / Dur√©e:** ${data.length}
**Niveau de complexit√©:** ${data.level}`;
            
            if (data.deadline) {
                prompt += `\n**D√©lai:** ${data.deadline}`;
            }
            
            prompt += `\n\n---

## üìù SP√âCIFICATIONS

**√âl√©ments √† INCLURE obligatoirement:**
${data.mustInclude}`;
            
            if (data.mustExclude) {
                prompt += `\n\n**√âl√©ments √† EXCLURE absolument:**\n${data.mustExclude}`;
            }
            
            prompt += `\n\n**Ton / Style:** ${data.tone}`;
            
            if (data.examples) {
                prompt += `\n\n**Exemples / R√©f√©rences:**\n${data.examples}`;
            }
            
            prompt += `\n\n---

## ‚úÖ CRIT√àRES QUALIT√â

**Crit√®res de succ√®s:**
${data.successCriteria}`;
            
            if (data.priorities) {
                prompt += `\n\n**Priorit√©s:**\n${data.priorities}`;
            }
            
            prompt += `\n\n---

## üöÄ INSTRUCTIONS DE PRODUCTION

En te basant sur ce brief complet:

1. **Analyse**: Assure-toi de bien comprendre tous les √©l√©ments du contexte
2. **Planification**: Structure ton approche pour couvrir tous les points
3. **Ex√©cution**: Produis un contenu de niveau expert
4. **Validation**: V√©rifie que tous les crit√®res de succ√®s sont atteints
5. **Optimisation**: Peaufine pour maximiser la qualit√©

**IMPORTANT**: Ce contenu doit √™tre imm√©diatement utilisable et d√©passer les attentes en termes de qualit√©, profondeur et pertinence.`;
            
            return prompt;
        }
        
        // ==========================================
        // DISPLAY RESULT
        // ==========================================
        function displayResult(prompt, analysis = null) {
            const resultSection = document.getElementById('resultSection');
            const promptOutput = document.getElementById('promptOutput');
            const analysisSection = document.getElementById('analysisSection');
            const analysisContent = document.getElementById('analysisContent');
            
            promptOutput.textContent = prompt;
            
            // Calculate stats
            const words = prompt.split(/\s+/).length;
            const chars = prompt.length;
            const sections = (prompt.match(/#{1,3}\s/g) || []).length;
            const score = calculateQualityScore(prompt);
            
            document.getElementById('statWords').textContent = words;
            document.getElementById('statChars').textContent = chars;
            document.getElementById('statSections').textContent = sections;
            document.getElementById('statScore').textContent = score + '%';
            
            // Display analysis if from audio mode
            if (analysis) {
                analysisSection.style.display = 'block';
                analysisContent.innerHTML = formatAnalysis(analysis);
            } else {
                analysisSection.style.display = 'none';
            }
            
            resultSection.classList.add('active');
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            currentPromptData = {
                prompt: prompt,
                analysis: analysis,
                timestamp: Date.now(),
                mode: currentMode
            };
        }
        
        function formatAnalysis(analysis) {
            let html = '<p style="color: var(--jazz-cream); opacity: 0.8; margin-bottom: 1.5rem;">Voici comment j\'ai structur√© ta description libre dans les 5 sections du prompt optimal :</p>';
            
            // Section 1: OBJECTIF
            html += `<div class="analysis-item">
                <div class="analysis-item-label">1Ô∏è‚É£ OBJECTIF</div>
                <div class="analysis-item-content">
                    <strong>Ce que tu veux cr√©er:</strong><br>
                    ${analysis.objective}<br><br>
                    <strong>R√©sultat attendu:</strong><br>
                    ${analysis.expectedResult}
                </div>
            </div>`;
            
            // Section 2: CONTEXTE
            html += `<div class="analysis-item">
                <div class="analysis-item-label">2Ô∏è‚É£ CONTEXTE</div>
                <div class="analysis-item-content">
                    <strong>Domaine:</strong> ${analysis.domain}<br>
                    <strong>Public cible:</strong> ${analysis.audience}`;
            
            if (analysis.usage) {
                html += `<br><strong>Usage:</strong> ${analysis.usage}`;
            }
            if (analysis.background) {
                html += `<br><strong>Background:</strong> ${analysis.background}`;
            }
            
            html += `</div></div>`;
            
            // Section 3: CONTRAINTES
            html += `<div class="analysis-item">
                <div class="analysis-item-label">3Ô∏è‚É£ CONTRAINTES</div>
                <div class="analysis-item-content">
                    <strong>Format:</strong> ${analysis.format}<br>
                    <strong>Longueur:</strong> ${analysis.length}<br>
                    <strong>Niveau:</strong> ${analysis.level}`;
            
            if (analysis.deadline) {
                html += `<br><strong>D√©lai:</strong> ${analysis.deadline}`;
            }
            
            html += `</div></div>`;
            
            // Section 4: SP√âCIFICATIONS
            html += `<div class="analysis-item">
                <div class="analysis-item-label">4Ô∏è‚É£ SP√âCIFICATIONS</div>
                <div class="analysis-item-content">
                    <strong>√Ä INCLURE:</strong><br>
                    ${analysis.mustInclude.split('\n').filter(l => l.trim()).map(l => `‚Ä¢ ${l.replace(/^-\s*/, '')}`).join('<br>')}`;
            
            if (analysis.mustExclude) {
                html += `<br><br><strong>√Ä EXCLURE:</strong><br>
                    ${analysis.mustExclude.split('\n').filter(l => l.trim()).map(l => `‚Ä¢ ${l.replace(/^-\s*/, '')}`).join('<br>')}`;
            }
            
            html += `<br><br><strong>Ton/Style:</strong> ${analysis.tone}`;
            
            if (analysis.examples) {
                html += `<br><strong>Exemples:</strong> ${analysis.examples}`;
            }
            
            html += `</div></div>`;
            
            // Section 5: CRIT√àRES QUALIT√â
            html += `<div class="analysis-item">
                <div class="analysis-item-label">5Ô∏è‚É£ CRIT√àRES QUALIT√â</div>
                <div class="analysis-item-content">
                    <strong>Crit√®res de succ√®s:</strong><br>
                    ${analysis.successCriteria.split('\n').filter(l => l.trim()).map(l => `‚Ä¢ ${l.replace(/^-\s*/, '')}`).join('<br>')}`;
            
            if (analysis.priorities) {
                html += `<br><br><strong>Priorit√©s:</strong><br>
                    ${analysis.priorities.split('\n').filter(l => l.trim()).join('<br>')}`;
            }
            
            html += `</div></div>`;
            
            return html;
        }
        
        function calculateQualityScore(prompt) {
            let score = 0;
            
            // Length (max 25 points)
            const words = prompt.split(/\s+/).length;
            if (words > 50) score += 10;
            if (words > 150) score += 10;
            if (words > 300) score += 5;
            
            // Structure (max 25 points)
            const headers = (prompt.match(/#{1,3}\s/g) || []).length;
            if (headers >= 3) score += 10;
            if (headers >= 6) score += 10;
            if (headers >= 9) score += 5;
            
            // Detail level (max 25 points)
            const bullets = (prompt.match(/^[-*]\s/gm) || []).length;
            if (bullets >= 3) score += 10;
            if (bullets >= 8) score += 10;
            if (bullets >= 12) score += 5;
            
            // Keywords presence (max 25 points)
            const keywords = ['objectif', 'contexte', 'contrainte', 'sp√©cification', 'qualit√©', 'r√©sultat'];
            const keywordCount = keywords.filter(kw => 
                prompt.toLowerCase().includes(kw)
            ).length;
            score += Math.min(25, keywordCount * 4);
            
            return Math.min(100, score);
        }
        
        // ==========================================
        // COPY PROMPT
        // ==========================================
        const copyPromptBtn = document.getElementById('copyPromptBtn');
        const copyModalPromptBtn = document.getElementById('copyModalPrompt');
        
        copyPromptBtn.addEventListener('click', () => {
            const promptText = document.getElementById('promptOutput').textContent;
            copyToClipboard(promptText);
        });
        
        copyModalPromptBtn.addEventListener('click', () => {
            const promptText = document.querySelector('#modalBody .prompt-output').textContent;
            copyToClipboard(promptText);
        });
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Prompt copi√© dans le presse-papier ! üìã', 'success');
            }).catch(() => {
                showToast('Erreur lors de la copie', 'error');
            });
        }
        
        // ==========================================
        // LIBRARY MANAGEMENT
        // ==========================================
        const savePromptBtn = document.getElementById('savePromptBtn');
        const newPromptBtn = document.getElementById('newPromptBtn');
        const searchLibraryInput = document.getElementById('searchLibrary');
        const filterTagsContainer = document.getElementById('filterTags');
        const promptsGrid = document.getElementById('promptsGrid');
        
        savePromptBtn.addEventListener('click', savePromptToLibrary);
        newPromptBtn.addEventListener('click', createNewPrompt);
        searchLibraryInput.addEventListener('input', filterLibrary);
        
        function savePromptToLibrary() {
            if (!currentPromptData) {
                showToast('Aucun prompt √† sauvegarder', 'error');
                return;
            }
            
            const project = document.getElementById('promptProject').value.trim();
            const tagsInput = document.getElementById('promptTags').value.trim();
            const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()) : [];
            
            if (!project) {
                showToast('Merci de saisir un nom de projet', 'error');
                return;
            }
            
            const promptId = 'prompt_' + Date.now();
            const promptEntry = {
                id: promptId,
                project: project,
                tags: tags,
                prompt: currentPromptData.prompt,
                analysis: currentPromptData.analysis,
                mode: currentPromptData.mode,
                timestamp: currentPromptData.timestamp,
                date: new Date().toLocaleDateString('fr-FR')
            };
            
            // Load existing library
            let library = JSON.parse(localStorage.getItem('promptLibrary') || '[]');
            library.push(promptEntry);
            localStorage.setItem('promptLibrary', JSON.stringify(library));
            
            // Update tags
            updateTagFilters();
            
            // Render library
            renderLibrary();
            
            showToast('Prompt sauvegard√© dans la biblioth√®que ! üíæ', 'success');
            
            // Clear save fields
            document.getElementById('promptProject').value = '';
            document.getElementById('promptTags').value = '';
        }
        
        function createNewPrompt() {
            if (confirm('Cr√©er un nouveau prompt ? Les donn√©es non sauvegard√©es seront perdues.')) {
                currentPromptData = null;
                document.getElementById('resultSection').classList.remove('active');
                
                if (currentMode === 'written') {
                    resetWrittenFormBtn.click();
                } else {
                    resetAudioBtn.click();
                }
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        function renderLibrary(filter = null) {
            const library = JSON.parse(localStorage.getItem('promptLibrary') || '[]');
            
            let filteredLibrary = library;
            
            if (filter && filter !== 'all') {
                filteredLibrary = library.filter(item => 
                    item.tags.includes(filter)
                );
            }
            
            if (filteredLibrary.length === 0) {
                promptsGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>Aucun prompt trouv√©.</p>
                    </div>
                `;
                return;
            }
            
            promptsGrid.innerHTML = filteredLibrary.reverse().map(item => `
                <div class="prompt-card" data-id="${item.id}">
                    <div class="prompt-card-header">
                        <div class="prompt-card-title">${item.project}</div>
                        <div class="prompt-card-date">${item.date}</div>
                    </div>
                    <div class="prompt-card-project">Mode: ${item.mode === 'written' ? '‚úçÔ∏è √âcrit' : 'üé§ Audio'}</div>
                    <div class="prompt-card-tags">
                        ${item.tags.map(tag => `<span class="prompt-card-tag">${tag}</span>`).join('')}
                    </div>
                    <div class="prompt-card-preview">${item.prompt.substring(0, 150)}...</div>
                    <div class="prompt-card-actions">
                        <button class="icon-btn view-prompt" data-id="${item.id}" title="Voir">üëÅÔ∏è</button>
                        <button class="icon-btn copy-prompt" data-id="${item.id}" title="Copier">üìã</button>
                        <button class="icon-btn delete-prompt" data-id="${item.id}" title="Supprimer">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners
            document.querySelectorAll('.view-prompt').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    viewPrompt(btn.dataset.id);
                });
            });
            
            document.querySelectorAll('.copy-prompt').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    copyPromptFromLibrary(btn.dataset.id);
                });
            });
            
            document.querySelectorAll('.delete-prompt').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deletePrompt(btn.dataset.id);
                });
            });
        }
        
        function updateTagFilters() {
            const library = JSON.parse(localStorage.getItem('promptLibrary') || '[]');
            const allTags = new Set();
            
            library.forEach(item => {
                item.tags.forEach(tag => allTags.add(tag));
            });
            
            filterTagsContainer.innerHTML = '<div class="tag active" data-filter="all">Tous</div>';
            
            Array.from(allTags).sort().forEach(tag => {
                filterTagsContainer.innerHTML += `<div class="tag" data-filter="${tag}">${tag}</div>`;
            });
            
            // Add click listeners
            document.querySelectorAll('.filter-tags .tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    document.querySelectorAll('.filter-tags .tag').forEach(t => t.classList.remove('active'));
                    tag.classList.add('active');
                    renderLibrary(tag.dataset.filter);
                });
            });
        }
        
        function filterLibrary() {
            const query = searchLibraryInput.value.toLowerCase();
            const library = JSON.parse(localStorage.getItem('promptLibrary') || '[]');
            
            const filtered = library.filter(item => 
                item.project.toLowerCase().includes(query) ||
                item.prompt.toLowerCase().includes(query) ||
                item.tags.some(tag => tag.toLowerCase().includes(query))
            );
            
            if (filtered.length === 0) {
                promptsGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <p>Aucun r√©sultat pour "${query}"</p>
                    </div>
                `;
                return;
            }
            
            promptsGrid.innerHTML = filtered.reverse().map(item => `
                <div class="prompt-card" data-id="${item.id}">
                    <div class="prompt-card-header">
                        <div class="prompt-card-title">${item.project}</div>
                        <div class="prompt-card-date">${item.date}</div>
                    </div>
                    <div class="prompt-card-project">Mode: ${item.mode === 'written' ? '‚úçÔ∏è √âcrit' : 'üé§ Audio'}</div>
                    <div class="prompt-card-tags">
                        ${item.tags.map(tag => `<span class="prompt-card-tag">${tag}</span>`).join('')}
                    </div>
                    <div class="prompt-card-preview">${item.prompt.substring(0, 150)}...</div>
                    <div class="prompt-card-actions">
                        <button class="icon-btn view-prompt" data-id="${item.id}" title="Voir">üëÅÔ∏è</button>
                        <button class="icon-btn copy-prompt" data-id="${item.id}" title="Copier">üìã</button>
                        <button class="icon-btn delete-prompt" data-id="${item.id}" title="Supprimer">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
            
            // Re-add event listeners
            document.querySelectorAll('.view-prompt').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    viewPrompt(btn.dataset.id);
                });
            });
            
            document.querySelectorAll('.copy-prompt').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    copyPromptFromLibrary(btn.dataset.id);
                });
            });
            
            document.querySelectorAll('.delete-prompt').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deletePrompt(btn.dataset.id);
                });
            });
        }
        
        function viewPrompt(id) {
            const library = JSON.parse(localStorage.getItem('promptLibrary') || '[]');
            const item = library.find(p => p.id === id);
            
            if (!item) return;
            
            const modal = document.getElementById('promptModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = item.project;
            
            let bodyHTML = `
                <div style="margin-bottom: 1rem;">
                    <strong>Date:</strong> ${item.date} | 
                    <strong>Mode:</strong> ${item.mode === 'written' ? '‚úçÔ∏è √âcrit' : 'üé§ Audio'}
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Tags:</strong> ${item.tags.join(', ')}
                </div>
            `;
            
            if (item.analysis) {
                bodyHTML += `
                    <div class="analysis-section">
                        <h3 class="analysis-title">üß† Analyse</h3>
                        ${formatAnalysis(item.analysis)}
                    </div>
                `;
            }
            
            bodyHTML += `
                <div style="margin-top: 1.5rem;">
                    <strong style="color: var(--jazz-gold); display: block; margin-bottom: 0.5rem;">Prompt:</strong>
                    <div class="prompt-output">${item.prompt}</div>
                </div>
            `;
            
            modalBody.innerHTML = bodyHTML;
            
            // Store current item for modal actions
            modal.dataset.currentId = id;
            
            modal.classList.add('active');
        }
        
        function copyPromptFromLibrary(id) {
            const library = JSON.parse(localStorage.getItem('promptLibrary') || '[]');
            const item = library.find(p => p.id === id);
            
            if (item) {
                copyToClipboard(item.prompt);
            }
        }
        
        function deletePrompt(id) {
            if (!confirm('Supprimer ce prompt d√©finitivement ?')) return;
            
            let library = JSON.parse(localStorage.getItem('promptLibrary') || '[]');
            library = library.filter(p => p.id !== id);
            localStorage.setItem('promptLibrary', JSON.stringify(library));
            
            updateTagFilters();
            renderLibrary();
            showToast('Prompt supprim√©', 'success');
        }
        
        // Modal controls
        const closeModalBtn = document.getElementById('closeModal');
        const deleteModalPromptBtn = document.getElementById('deleteModalPrompt');
        const promptModal = document.getElementById('promptModal');
        
        closeModalBtn.addEventListener('click', () => {
            promptModal.classList.remove('active');
        });
        
        deleteModalPromptBtn.addEventListener('click', () => {
            const id = promptModal.dataset.currentId;
            if (id) {
                deletePrompt(id);
                promptModal.classList.remove('active');
            }
        });
        
        // Close modal on outside click
        promptModal.addEventListener('click', (e) => {
            if (e.target === promptModal) {
                promptModal.classList.remove('active');
            }
        });
        
        // ==========================================
        // TOAST NOTIFICATIONS
        // ==========================================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = 'toast active ' + type;
            
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }
        
        // ==========================================
        // INITIALIZATION
        // ==========================================
        window.addEventListener('DOMContentLoaded', () => {
            renderLibrary();
            updateTagFilters();
        });
        
        // Check browser support
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            document.getElementById('audioMode').innerHTML = `
                <div class="audio-mode">
                    <h2 class="audio-title">‚ö†Ô∏è Reconnaissance vocale non support√©e</h2>
                    <p class="audio-subtitle">Ton navigateur ne supporte pas la reconnaissance vocale. Essaie avec Chrome ou Safari sur Mac.</p>
                </div>
            `;
        }
    </script>
</body>
</html>